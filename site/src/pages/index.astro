---
import BaseLayout from "../layouts/BaseLayout.astro";
import HeroSection from "../components/HeroSection.astro";
import ChartCard from "../components/ChartCard.astro";
import ImageRow from "../components/ImageRow.astro";
import SearchFilter from "../components/SearchFilter.astro";
import { catalog, getChartNames, getChartVersions } from "../lib/catalog";

// Show one card per unique chart name (use the first/latest version for display)
const uniqueCharts = getChartNames().map((name) => getChartVersions(name)[0]);
---

<BaseLayout title="Verity â€” Security-Patched Registry">
  <HeroSection />

  {
    uniqueCharts.length > 0 && (
      <section class="mb-10">
        <h2 class="text-xl font-semibold mb-4">Charts</h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
          {uniqueCharts.map((chart) => (
            <ChartCard chart={chart} />
          ))}
        </div>
      </section>
    )
  }

  {
    (catalog.images ?? catalog.standaloneImages ?? []).length > 0 && (
      <section>
        <div class="flex items-center justify-between mb-4 flex-wrap gap-3">
          <h2 class="text-xl font-semibold">Images</h2>
          <SearchFilter targetId="images-list" />
        </div>
        <div id="images-list" class="space-y-2">
          {(catalog.images ?? catalog.standaloneImages ?? []).map((image) => (
            <ImageRow image={image} />
          ))}
        </div>
      </section>
    )
  }
</BaseLayout>
