---
import type { SiteImage } from "../lib/catalog";
import { shortName } from "../lib/catalog";

interface Props {
  image: SiteImage;
}

const { image } = Astro.props;
const base = import.meta.env.BASE_URL;
const display = shortName(image.originalRef);
const fixed = image.beforeVulns.total - image.afterVulns.total;
const remaining = image.afterVulns.total;
---

<a
  href={`${base}images/${image.id}/`}
  class="flex items-center justify-between p-3 border border-verity-border rounded-lg hover:border-verity-orbit hover:bg-verity-surface transition-all bg-verity-void/50"
  data-searchable={image.originalRef.toLowerCase()}
>
  <div class="min-w-0 flex-1">
    <div class="font-mono text-sm truncate text-verity-text-primary">
      {display}
    </div>
    {image.os && <div class="text-xs text-verity-text-secondary">{image.os}</div>}
  </div>
  <div class="flex items-center gap-2 ml-4 shrink-0">
    {
      fixed > 0 ? (
        <div class="flex items-center gap-2">
          <span class="text-verity-nucleus text-sm font-medium flex items-center gap-1">
            <svg
              class="w-4 h-4"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              stroke-width="2.5"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
              />
            </svg>
            {fixed} fixed
          </span>
          {remaining > 0 && (
            <span class="text-xs text-verity-text-secondary">{remaining} remaining</span>
          )}
        </div>
      ) : image.beforeVulns.total > 0 ? (
        <div class="flex items-center gap-2">
          <span class="text-verity-nucleus text-sm font-medium flex items-center gap-1">
            <svg
              class="w-4 h-4"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              stroke-width="2.5"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
              />
            </svg>
            clean
          </span>
          <span class="text-xs text-verity-text-secondary">
            {image.beforeVulns.total} unfixable
          </span>
        </div>
      ) : (
        <span class="text-verity-nucleus text-sm font-medium flex items-center gap-1">
          <svg
            class="w-4 h-4"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2.5"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
            />
          </svg>
          clean
        </span>
      )
    }
  </div>
</a>
