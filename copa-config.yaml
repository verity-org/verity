apiVersion: copa.sh/v1alpha1
kind: PatchConfig

# Standalone images to patch. Chart-sourced images are declared in Chart.yaml
# (dependencies:) and picked up automatically by `verity discover`.
target:
  registry: "ghcr.io/verity-org"

images:
  # Copa-compatible images (8 total across Debian/Ubuntu/Alpine/distroless bases)
  # Using mirror.gcr.io to avoid Docker Hub rate limits
  # Only patch amd64 and arm64; other platforms preserved but not patched
  - name: "nginx"
    image: "mirror.gcr.io/library/nginx"
    platforms: ["linux/amd64", "linux/arm64"]
    tags:
      strategy: "pattern"
      pattern: '^\d+\.\d+\.\d+$'
      maxTags: 3

  - name: "rabbitmq"
    image: "mirror.gcr.io/library/rabbitmq"
    platforms: ["linux/amd64", "linux/arm64"]
    tags:
      strategy: "pattern"
      pattern: '^\d+\.\d+\.\d+$'
      maxTags: 3

  - name: "vector-debian"
    image: "ghcr.io/vectordotdev/vector"
    platforms: ["linux/amd64", "linux/arm64"]
    tags:
      strategy: "pattern"
      pattern: '^\d+\.\d+\.\d+-debian$'
      maxTags: 3

  - name: "vector-alpine"
    image: "ghcr.io/vectordotdev/vector"
    platforms: ["linux/amd64", "linux/arm64"]
    tags:
      strategy: "pattern"
      pattern: '^\d+\.\d+\.\d+-alpine$'
      maxTags: 3

  - name: "redis"
    image: "quay.io/opstree/redis"
    platforms: ["linux/amd64", "linux/arm64"]
    tags:
      strategy: "pattern"
      pattern: '^v\d+\.\d+\.\d+$'
      maxTags: 3

  - name: "redis-sentinel"
    image: "quay.io/opstree/redis-sentinel"
    platforms: ["linux/amd64", "linux/arm64"]
    tags:
      strategy: "pattern"
      pattern: '^v\d+\.\d+\.\d+$'
      maxTags: 3

  - name: "grafana-ubuntu"
    image: "mirror.gcr.io/grafana/grafana"
    platforms: ["linux/amd64", "linux/arm64"]
    tags:
      strategy: "pattern"
      pattern: '^\d+\.\d+\.\d+-ubuntu$'
      maxTags: 3

  - name: "prometheus-distroless"
    image: "quay.io/prometheus/prometheus"
    platforms: ["linux/amd64", "linux/arm64"]
    tags:
      strategy: "pattern"
      pattern: '^\d+\.\d+\.\d+-distroless$'
      maxTags: 3

  - name: "k8s-sidecar"
    image: "ghcr.io/kiwigrid/k8s-sidecar"
    platforms: ["linux/amd64", "linux/arm64"]
    tags:
      strategy: "pattern"
      pattern: '^\d+\.\d+\.\d+$'
      maxTags: 3
