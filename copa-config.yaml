apiVersion: copa.sh/v1alpha1
kind: PatchConfig

# Strategy: Pattern-based with maxTags to automatically patch the latest 3 versions
# This auto-updates as new versions are released without manual version updates
target:
  registry: "ghcr.io/verity-org"

images:
  # Copa-compatible images (Debian/Ubuntu-based)
  - name: "nginx"
    image: "docker.io/library/nginx"
    tags:
      strategy: "pattern"
      pattern: '^\d+\.\d+\.\d+$'
      maxTags: 3

  - name: "rabbitmq"
    image: "docker.io/library/rabbitmq"
    tags:
      strategy: "pattern"
      pattern: '^\d+\.\d+\.\d+$'
      maxTags: 3

  - name: "vector-debian"
    image: "docker.io/timberio/vector"
    tags:
      strategy: "pattern"
      pattern: '^\d+\.\d+\.\d+-debian$'
      maxTags: 3

  - name: "redis"
    image: "quay.io/opstree/redis"
    tags:
      strategy: "pattern"
      pattern: '^v\d+\.\d+\.\d+$'
      maxTags: 3

  - name: "redis-sentinel"
    image: "quay.io/opstree/redis-sentinel"
    tags:
      strategy: "pattern"
      pattern: '^v\d+\.\d+\.\d+$'
      maxTags: 3

  # Ubuntu-based variants (Copa-compatible)
  - name: "grafana-ubuntu"
    image: "docker.io/grafana/grafana"
    tags:
      strategy: "pattern"
      pattern: '^\d+\.\d+\.\d+-ubuntu$'
      maxTags: 3

  - name: "prometheus-ubuntu"
    image: "docker.io/ubuntu/prometheus"
    tags:
      strategy: "pattern"
      pattern: '^\d+\.\d+\.\d+$'
      maxTags: 3
