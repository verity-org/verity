apiVersion: copa.sh/v1alpha1
kind: PatchConfig

# Strategy: Pattern-based with maxTags to automatically patch the latest 3 versions
# This auto-updates as new versions are released without manual version updates
target:
  registry: "ghcr.io/verity-org"

images:
  # Copa-compatible images (Debian/Ubuntu-based)
  # Using mirror.gcr.io to avoid Docker Hub rate limits
  - name: "nginx"
    image: "mirror.gcr.io/library/nginx"
    tags:
      strategy: "pattern"
      pattern: '^\d+\.\d+\.\d+$'
      maxTags: 3

  - name: "rabbitmq"
    image: "mirror.gcr.io/library/rabbitmq"
    tags:
      strategy: "pattern"
      pattern: '^\d+\.\d+\.\d+$'
      maxTags: 3

  - name: "vector-debian"
    image: "mirror.gcr.io/vectordotdev/vector"
    tags:
      strategy: "pattern"
      pattern: '^\d+\.\d+\.\d+-debian$'
      maxTags: 3

  - name: "vector-alpine"
    image: "mirror.gcr.io/vectordotdev/vector"
    tags:
      strategy: "pattern"
      pattern: '^\d+\.\d+\.\d+-alpine$'
      maxTags: 3

  - name: "redis"
    image: "quay.io/opstree/redis"
    tags:
      strategy: "pattern"
      pattern: '^v\d+\.\d+\.\d+$'
      maxTags: 3

  - name: "redis-sentinel"
    image: "quay.io/opstree/redis-sentinel"
    tags:
      strategy: "pattern"
      pattern: '^v\d+\.\d+\.\d+$'
      maxTags: 3

  - name: "grafana-ubuntu"
    image: "mirror.gcr.io/grafana/grafana"
    tags:
      strategy: "pattern"
      pattern: '^\d+\.\d+\.\d+-ubuntu$'
      maxTags: 3

  - name: "prometheus-distroless"
    image: "quay.io/prometheus/prometheus"
    tags:
      strategy: "pattern"
      pattern: '^\d+\.\d+\.\d+-distroless$'
      maxTags: 3
